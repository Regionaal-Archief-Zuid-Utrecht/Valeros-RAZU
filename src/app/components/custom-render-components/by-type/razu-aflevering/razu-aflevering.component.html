<app-snippet [altoUrl]="altoUrl" />

<!-- Loading indicator -->
<div *ngIf="loading" class="loading">Loading data...</div>

<!-- isOnderdeelVan related data -->
<div *ngIf="!loading && data?.node" class="node-data">
  <h4>Onderdeel van</h4>

  <!-- For each isOnderdeelVan, show details -->
  <div *ngFor="let onderdeelVanId of onderdeelVanIds" class="related-item">
    <details role="group" (toggle)="onDetailsToggle($event)">
      <summary role="heading" aria-level="2" tabindex="0">
        <app-hop-link
          [data]="{
            value: onderdeelVanId ?? '',
            hopLinkSettings: {
              preds: ['https://data.razu.nl/def/ldto/naam'],
              showHops: false,
            },
          }"
        >
        </app-hop-link>
      </summary>
      <div role="region">
        <!-- dekkingInRuimte -->
        <h5>Uitgebracht in</h5>
        <div>
          <div
            *ngFor="let ruimteId of getDekkingInRuimteIds(onderdeelVanId)"
            class="mb-1"
          >
            <app-hop-link
              [data]="{
                value: ruimteId ?? '',
                hopLinkSettings: {
                  preds: ['http://schema.org/name'],
                  showHops: false,
                },
              }"
            >
            </app-hop-link>
          </div>
          <div
            *ngIf="getDekkingInRuimteIds(onderdeelVanId).length === 0"
            class="text-muted"
          >
            Geen gebied gespecificeerd
          </div>
        </div>

        <!-- dekkingintijd -->
        <h5>Digitaal beschikbaar bij het RAZU</h5>
        <div
          *ngIf="
            hasBeginDateForId(onderdeelVanId) || hasEndDateForId(onderdeelVanId)
          "
        >
          <span *ngIf="hasBeginDateForId(onderdeelVanId)"
            >Van
            {{ getBeginDate(onderdeelVanId) | date: "d MMMM y" : "" : "nl" }}
          </span>
          <span
            *ngIf="
              hasBeginDateForId(onderdeelVanId) &&
              hasEndDateForId(onderdeelVanId)
            "
          >
            tot
          </span>
          <span *ngIf="hasEndDateForId(onderdeelVanId)">{{
            getEndDate(onderdeelVanId) | date: "d MMMM y" : "" : "nl"
          }}</span>
        </div>
        <div
          *ngIf="
            !hasBeginDateForId(onderdeelVanId) &&
            !hasEndDateForId(onderdeelVanId)
          "
          class="text-muted"
        >
          Geen periode gespecificeerd
        </div>
      </div>
    </details>
  </div>
</div>

<!-- beperkingGebruik data -->
<div *ngIf="!loading && data?.node" class="node-data">
  <div class="flex items-center gap-2 mb-2">
    <h4 class="inline-block mb-0">Auteursrecht en openbaarheid</h4>
    <button
      type="button"
      class="info-button relative bottom-[0.15rem]"
      [attr.aria-label]="'Informatie over auteursrecht en openbaarheid'"
      [attr.aria-expanded]="showCopyrightInfo"
      aria-controls="copyright-info-panel"
      (click)="showCopyrightInfo = !showCopyrightInfo"
    >
      <ng-icon [svg]="featherHelpCircle" aria-hidden="true"></ng-icon>
    </button>
  </div>

  <div
    *ngIf="showCopyrightInfo"
    class="info-panel mb-3"
    id="copyright-info-panel"
    role="region"
  >
    <p>
      Niet elk stuk dat u ziet op deze website is vrij beschikbaar en bruikbaar.
      Op basis van de Archiefwet, de Algemene Verordening Gegevensbescherming
      (AVG) en de Auteurswet is het mogelijk dat u sommige stukken niet kunt
      zien of kunt gebruiken.
    </p>
    <p>
      Hieronder vindt u de beperkingen van het stuk dat u bekijkt. U kunt op de
      beperking klikken om meer informatie te krijgen.
    </p>
  </div>

  <!-- For each beperkingGebruik, show details -->
  <div *ngFor="let beperkingId of beperkingGebruikIds" class="beperking-item">
    <details role="group" (toggle)="onDetailsToggle($event)">
      <!-- Use prefLabel as summary -->
      <summary role="heading" aria-level="2" tabindex="0">
        <app-hop-link
          [data]="{
            value: beperkingId ?? '',
            hopLinkSettings: {
              preds: [
                'https://data.razu.nl/def/ldto/beperkingGebruikType',
                'http://www.w3.org/2004/02/skos/core#prefLabel',
              ],
              showHops: false,
            },
          }"
        >
        </app-hop-link>
      </summary>
      <!-- Termijn -->
      <div role="region">
        <div *ngIf="beperkingGebruikTermijnMap.get(beperkingId)?.length">
          <h5>Vervaldatum</h5>

          <div
            *ngFor="
              let termijnId of beperkingGebruikTermijnMap.get(beperkingId) || []
            "
            class="mb-1"
          >
            <div *ngIf="termijnEinddatumMap.has(termijnId)">
              {{
                termijnEinddatumMap.get(termijnId)
                  | date: "d MMMM y" : "" : "nl"
              }}
            </div>
          </div>
        </div>
      </div>
      <!-- Copyright Notice -->
      <div>
        <div *ngIf="copyrightNoticeMap.get(beperkingId)?.length">
          <h5>Copyright</h5>
          {{ copyrightNoticeMap.get(beperkingId) }}
        </div>
      </div>

      <!-- Note -->
      <div>
        <div *ngIf="copyrightNoteMap.get(beperkingId)?.length">
          <h5>Toelichting</h5>
          {{ copyrightNoteMap.get(beperkingId) }}
        </div>
      </div>
    </details>
  </div>
</div>

<!-- No data message -->
<div
  *ngIf="
    !loading &&
    (!data?.node ||
      !data?.node?.['@id']?.length ||
      (onderdeelVanIds.length === 0 && beperkingGebruikIds.length === 0))
  "
  class="no-data"
>
  No related data found for this node.
</div>
<ng-container
  *ngIf="
    !loading &&
    !hideDownloads &&
    (data?.node?.['https://data.razu.nl/def/ldto/isRepresentatieVan']?.length ||
      0) > 0
  "
>
  <details (toggle)="onDownloadToggle($event)">
    <summary role="heading" aria-level="2">Downloaden</summary>
    <div *ngIf="repMetaFetching">Downloadlinks aan het ophalen...</div>
    <ol class="list-decimal ml-6" *ngIf="repMetaLoaded">
      <ng-container
        *ngFor="
          let rep of data?.node?.[
            'https://data.razu.nl/def/ldto/isRepresentatieVan'
          ] || [];
          trackBy: trackByRep
        "
      >
        <ng-container *ngIf="getFirstImageUrl(rep) as imgUrl; else skip">
          <li>
            <a
              [href]="imgUrl"
              class="text-blue-600 underline"
              target="_blank"
              rel="noopener noreferrer"
            >
              Download pagina {{ getPage(rep) || "?" }}
              <ng-container *ngIf="formatBytes(getSizeBytes(rep)) as size">
                ({{ size }})
              </ng-container>
            </a>
          </li>
        </ng-container>
        <ng-template #skip></ng-template>
      </ng-container>
    </ol>
  </details>
</ng-container>
<!-- For debugging, you can show the raw data -->
<!-- <details>
    <summary>Debug: Raw Node Data</summary>
    <pre>{{ data?.node | json }}</pre>
</details>  -->
