<div class="razu-aflevering-container">
    <h3>Aflevering</h3>

    <!-- Loading indicator -->
    <div *ngIf="loading" class="loading">
        Loading data...
    </div>

    <!-- isOnderdeelVan related data -->
    <div *ngIf="!loading && data?.node" class="node-data">
        <h4>Onderdeel van</h4>

        <!-- Get isOnderdeelVan links -->
        <app-hop-link [data]="{
                value: data?.node?.['@id']?.[0]?.value ?? '',
                hopLinkSettings: onderdeelVanSettings
            }" (hopObjIdsRetrieved)="onderdeelVanIds = $event">
        </app-hop-link>

        <!-- For each isOnderdeelVan, show details -->
        <div *ngFor="let onderdeelVanId of onderdeelVanIds" class="related-item">
            <div>
                <!-- dekkingInRuimte -->
                <details>
                    <summary>Gebied</summary>
                    <div>
                        <app-hop-link [data]="{
                                value: onderdeelVanId ?? '',
                                hopLinkSettings: dekkingInRuimteSettings
                            }" (hopObjIdsRetrieved)="dekkingInRuimteIds = $event">
                        </app-hop-link>
                    </div>

                    <!-- Display each retrieved value on a new line -->
                    <div *ngIf="dekkingInRuimteIds && dekkingInRuimteIds.length > 0" class="mt-2">
                        <div *ngFor="let ruimteId of dekkingInRuimteIds" class="mb-1">
                            <app-hop-link [data]="{
                                    value: ruimteId ?? '',
                                    hopLinkSettings: {
                                        preds: ['http://www.w3.org/2000/01/rdf-schema#label'],
                                        showHops: false
                                    }
                                }"><br />
                            </app-hop-link>
                        </div>
                    </div>
                </details>

                <!-- dekkingintijd -->
                <details>
                    <summary>Verschijningsperiode</summary>
                    <app-hop-link [data]="{
                            value: onderdeelVanId ?? '',
                            hopLinkSettings: {
                                preds: ['https://data.razu.nl/def/ldto/dekkingInTijd', 'https://data.razu.nl/def/ldto/dekkingInTijdBeginDatum'],
                                showHops: false,
                            },
                        }" (hopObjIdsRetrieved)="this.hasBeginDate = $event.length > 0" />

                    <div class="inline">
                        <span *ngIf="hasBeginDate && hasEndDate"> - </span>
                        <app-hop-link [data]="{
                            value: onderdeelVanId ?? '',
                            hopLinkSettings: {
                                preds: ['https://data.razu.nl/def/ldto/dekkingInTijd', 'https://data.razu.nl/def/ldto/dekkingInTijdEindDatum'],
                                showHops: false,
                            },
                        }" (hopObjIdsRetrieved)="this.hasEndDate = $event.length > 0" />
                    </div>

                    <div class="inline">
                        <span *ngIf="hasBeginDate || hasEndDate"> (</span>
                        <app-hop-link [data]="{
                            value: onderdeelVanId ?? '',
                            hopLinkSettings: {
                                preds: ['https://data.razu.nl/def/ldto/dekkingInTijd', 'https://data.razu.nl/def/ldto/dekkingInTijdType'],
                                showHops: false,
                            },
                        }" (hopObjIdsRetrieved)="this.hasType = $event.length > 0" />
                        <span *ngIf="hasBeginDate || hasEndDate">)</span>
                    </div>

                    <!-- <app-hop-link [data]="{
                        value: onderdeelVanId ?? '',
                        hopLinkSettings: {
                                preds: ['https://data.razu.nl/def/ldto/dekkingInTijd', 'https://data.razu.nl/def/ldto/dekkingInTijdBeginDatum'],
                                showHops: false
                            }
                    }">
                    </app-hop-link> -->
                </details>
            </div>
        </div>
    </div>

    <!-- beperkingGebruik data -->
    <div *ngIf="!loading && data?.node" class="node-data">
        <h4>Auteursrecht en openbaarheid</h4>

        <!-- Get beperkingGebruik links -->
        <app-hop-link [data]="{
                value: data?.node?.['@id']?.[0]?.value ?? '',
                hopLinkSettings: beperkingGebruikSettings
            }" (hopObjIdsRetrieved)="beperkingGebruikIds = $event">
        </app-hop-link>

        <!-- For each beperkingGebruik, show details -->
        <div *ngFor="let beperkingId of beperkingGebruikIds" class="beperking-item">
            <details>
                <!-- Use prefLabel as summary -->
                <summary>
                    <app-hop-link [data]="{
                            value: beperkingId ?? '',
                            hopLinkSettings: prefLabelSettings
                        }">
                    </app-hop-link>
                </summary>

                <!-- copyrightNotice -->
                <details>
                    <summary>Copyright</summary>
                    <app-hop-link [data]="{
                            value: beperkingId ?? '',
                            hopLinkSettings: copyrightNoticeSettings
                        }">
                    </app-hop-link>
                </details>

                <!-- note -->
                <details>
                    <summary>Note</summary>
                    <app-hop-link [data]="{
                            value: beperkingId ?? '',
                            hopLinkSettings: noteSettings
                        }">
                    </app-hop-link>
                </details>
            </details>
        </div>
    </div>

    <!-- No data message -->
    <div *ngIf="!loading && (!data?.node || !data?.node?.['@id']?.length || (onderdeelVanIds.length === 0 && beperkingGebruikIds.length === 0))"
        class="no-data">
        No related data found for this node.
    </div>

    <!-- For debugging, you can show the raw data -->
    <details>
        <summary>Debug: Raw Node Data</summary>
        <pre>{{ data?.node | json }}</pre>
    </details>
</div>